@{
    ViewData["Title"] = "Quản lý chương - Giảng viên";
}

@section Styles {
    <style>
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem 0;
            margin-top: 70px;
            color: white;
        }

        .course-info-bar {
            background: white;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .course-title-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .course-thumbnail-small {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .chapters-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .chapter-card {
            background: white;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: all 0.3s ease;
        }

            .chapter-card:hover {
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
            }

        .chapter-header {
            padding: 1.5rem;
            background: linear-gradient(to right, rgba(5, 150, 105, 0.05), transparent);
            border-left: 4px solid #059669;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .chapter-header:hover {
                background: linear-gradient(to right, rgba(5, 150, 105, 0.1), transparent);
            }

        .chapter-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .drag-handle {
            cursor: move;
            color: var(--text-light);
            font-size: 1.5rem;
        }

            .drag-handle:hover {
                color: var(--text-dark);
            }

        .chapter-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .chapter-info {
            flex: 1;
        }

        .chapter-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .chapter-meta {
            color: var(--text-light);
            font-size: 0.9rem;
            display: flex;
            gap: 1rem;
        }

        .chapter-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .btn-expand {
            background: var(--bg-light);
            color: var(--text-dark);
        }

            .btn-expand:hover {
                background: var(--border-color);
            }

        .btn-edit-chapter {
            background: var(--primary-color);
            color: white;
        }

            .btn-edit-chapter:hover {
                background: #1e40af;
                transform: scale(1.05);
            }

        .btn-delete-chapter {
            background: var(--danger-color);
            color: white;
        }

            .btn-delete-chapter:hover {
                background: #dc2626;
                transform: scale(1.05);
            }

        .chapter-body {
            padding: 1.5rem;
            border-top: 2px solid var(--border-color);
            display: none;
            background: var(--bg-light);
        }

            .chapter-body.show {
                display: block;
            }

        .lessons-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .lesson-item {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

            .lesson-item:hover {
                border-color: #059669;
                transform: translateX(5px);
            }

        .lesson-item-left {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .lesson-drag-handle {
            cursor: move;
            color: var(--text-light);
        }

        .lesson-number {
            width: 30px;
            height: 30px;
            background: var(--bg-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-dark);
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .lesson-duration {
            color: var(--text-light);
            font-size: 0.85rem;
        }

        .lesson-type-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .lesson-type-video {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
        }

        .lesson-type-quiz {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent-color);
        }

        .lesson-type-reading {
            background: rgba(5, 150, 105, 0.1);
            color: #059669;
        }

        .lesson-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-add-lesson {
            width: 100%;
            padding: 1rem;
            background: white;
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            color: var(--text-light);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .btn-add-lesson:hover {
                border-color: #059669;
                color: #059669;
                background: rgba(5, 150, 105, 0.05);
            }

        .empty-lessons {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }

        .add-chapter-card {
            background: white;
            border: 3px dashed var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .add-chapter-card:hover {
                border-color: #059669;
                background: rgba(5, 150, 105, 0.05);
            }

        .add-chapter-icon {
            font-size: 3rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

            .modal.show {
                display: flex;
                align-items: center;
                justify-content: center;
            }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .btn-close-modal {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: var(--bg-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

            .btn-close-modal:hover {
                background: var(--border-color);
            }

        @@media (max-width: 768px) {
            .chapter-header-left {
                flex-direction: column;
                align-items: flex-start;
            }

            .chapter-actions {
                flex-wrap: wrap;
            }

            .lesson-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .lesson-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
}

<div class="page-header">
    <div class="container">
        <h1 class="text-center mb-2"><i class="bi bi-folder"></i> Quản lý chương</h1>
        <p class="text-center mb-0 opacity-75">Tổ chức nội dung khóa học theo chương và bài học</p>
    </div>
</div>

<div class="container py-4">
    <!-- Course Info Bar -->
    <div class="course-info-bar">
        <div class="course-title-info">
            <div class="course-thumbnail-small">
                <i class="bi bi-book-fill"></i>
            </div>
            <div>
                <h3 class="mb-0" style="font-size: 1.1rem; font-weight: 700;">ASP.NET Core MVC - Full Stack Development</h3>
                <small class="text-muted">5 chương • 45 bài học • 12 giờ</small>
            </div>
        </div>
        <div class="d-flex gap-2">
            <a href="@Url.Action("MyCourses", "Instructor")" class="btn btn-outline-custom">
                <i class="bi bi-arrow-left"></i> Quay lại
            </a>
            <button class="btn btn-primary-custom" onclick="openAddChapterModal()">
                <i class="bi bi-plus-circle"></i> Thêm chương
            </button>
        </div>
    </div>

    <div class="chapters-container">
        <!-- Chapter 1 -->
        <div class="chapter-card">
            <div class="chapter-header" onclick="toggleChapter(this)">
                <div class="chapter-header-left">
                    <i class="bi bi-grip-vertical drag-handle"></i>
                    <div class="chapter-number">1</div>
                    <div class="chapter-info">
                        <div class="chapter-title">Giới thiệu về ASP.NET Core MVC</div>
                        <div class="chapter-meta">
                            <span><i class="bi bi-book"></i> 8 bài học</span>
                            <span><i class="bi bi-clock"></i> 2.5 giờ</span>
                        </div>
                    </div>
                </div>
                <div class="chapter-actions" onclick="event.stopPropagation()">
                    <button class="btn-icon btn-expand">
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <button class="btn-icon btn-edit-chapter" onclick="openEditChapterModal(1)">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn-icon btn-delete-chapter" onclick="deleteChapter(1)">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
            <div class="chapter-body">
                <div class="lessons-list">
                    <!-- Lesson 1 -->
                    <div class="lesson-item">
                        <div class="lesson-item-left">
                            <i class="bi bi-grip-vertical lesson-drag-handle"></i>
                            <div class="lesson-number">1.1</div>
                            <div class="lesson-info">
                                <div class="lesson-title">Tổng quan về ASP.NET Core</div>
                                <div class="lesson-duration">
                                    <i class="bi bi-play-circle"></i> 15 phút
                                </div>
                            </div>
                            <span class="lesson-type-badge lesson-type-video">
                                <i class="bi bi-camera-video"></i> Video
                            </span>
                        </div>
                        <div class="lesson-actions">
                            <button class="btn-icon btn-edit-chapter" onclick="openEditLessonModal(1)">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn-icon btn-delete-chapter" onclick="deleteLesson(1)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Lesson 2 -->
                    <div class="lesson-item">
                        <div class="lesson-item-left">
                            <i class="bi bi-grip-vertical lesson-drag-handle"></i>
                            <div class="lesson-number">1.2</div>
                            <div class="lesson-info">
                                <div class="lesson-title">Cài đặt môi trường phát triển</div>
                                <div class="lesson-duration">
                                    <i class="bi bi-play-circle"></i> 20 phút
                                </div>
                            </div>
                            <span class="lesson-type-badge lesson-type-video">
                                <i class="bi bi-camera-video"></i> Video
                            </span>
                        </div>
                        <div class="lesson-actions">
                            <button class="btn-icon btn-edit-chapter">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn-icon btn-delete-chapter">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Lesson 3 -->
                    <div class="lesson-item">
                        <div class="lesson-item-left">
                            <i class="bi bi-grip-vertical lesson-drag-handle"></i>
                            <div class="lesson-number">1.3</div>
                            <div class="lesson-info">
                                <div class="lesson-title">Kiến trúc MVC Pattern</div>
                                <div class="lesson-duration">
                                    <i class="bi bi-file-text"></i> 10 phút đọc
                                </div>
                            </div>
                            <span class="lesson-type-badge lesson-type-reading">
                                <i class="bi bi-file-text"></i> Đọc
                            </span>
                        </div>
                        <div class="lesson-actions">
                            <button class="btn-icon btn-edit-chapter">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn-icon btn-delete-chapter">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button class="btn-add-lesson mt-3" onclick="openAddLessonModal(1)">
                    <i class="bi bi-plus-circle"></i> Thêm bài học mới
                </button>
            </div>
        </div>

        <!-- Chapter 2 -->
        <div class="chapter-card">
            <div class="chapter-header" onclick="toggleChapter(this)">
                <div class="chapter-header-left">
                    <i class="bi bi-grip-vertical drag-handle"></i>
                    <div class="chapter-number">2</div>
                    <div class="chapter-info">
                        <div class="chapter-title">Controllers và Routing</div>
                        <div class="chapter-meta">
                            <span><i class="bi bi-book"></i> 10 bài học</span>
                            <span><i class="bi bi-clock"></i> 3 giờ</span>
                        </div>
                    </div>
                </div>
                <div class="chapter-actions" onclick="event.stopPropagation()">
                    <button class="btn-icon btn-expand">
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <button class="btn-icon btn-edit-chapter">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn-icon btn-delete-chapter">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
            <div class="chapter-body">
                <div class="empty-lessons">
                    <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                    <p class="mb-0 mt-2">Chưa có bài học nào</p>
                </div>
                <button class="btn-add-lesson mt-3" onclick="openAddLessonModal(2)">
                    <i class="bi bi-plus-circle"></i> Thêm bài học mới
                </button>
            </div>
        </div>

        <!-- Chapter 3 -->
        <div class="chapter-card">
            <div class="chapter-header" onclick="toggleChapter(this)">
                <div class="chapter-header-left">
                    <i class="bi bi-grip-vertical drag-handle"></i>
                    <div class="chapter-number">3</div>
                    <div class="chapter-info">
                        <div class="chapter-title">Views và Razor Syntax</div>
                        <div class="chapter-meta">
                            <span><i class="bi bi-book"></i> 12 bài học</span>
                            <span><i class="bi bi-clock"></i> 3.5 giờ</span>
                        </div>
                    </div>
                </div>
                <div class="chapter-actions" onclick="event.stopPropagation()">
                    <button class="btn-icon btn-expand">
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <button class="btn-icon btn-edit-chapter">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn-icon btn-delete-chapter">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
            <div class="chapter-body">
                <div class="empty-lessons">
                    <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                    <p class="mb-0 mt-2">Chưa có bài học nào</p>
                </div>
                <button class="btn-add-lesson mt-3">
                    <i class="bi bi-plus-circle"></i> Thêm bài học mới
                </button>
            </div>
        </div>

        <!-- Add Chapter Card -->
        <div class="add-chapter-card" onclick="openAddChapterModal()">
            <i class="bi bi-plus-circle add-chapter-icon"></i>
            <h4>Thêm chương mới</h4>
            <p class="text-muted mb-0">Nhấp để tạo chương tiếp theo cho khóa học</p>
        </div>
    </div>
</div>

<!-- Modal Add/Edit Chapter -->
<div id="chapterModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="chapterModalTitle">Thêm chương mới</h3>
            <button class="btn-close-modal" onclick="closeChapterModal()">
                <i class="bi bi-x"></i>
            </button>
        </div>
        <form>
            <div class="form-group">
                <label class="form-label">Tên chương <span style="color: var(--danger-color);">*</span></label>
                <input type="text" class="form-control" placeholder="VD: Giới thiệu về ASP.NET Core MVC" required>
            </div>
            <div class="form-group">
                <label class="form-label">Mô tả chương</label>
                <textarea class="form-control" rows="4" placeholder="Mô tả ngắn gọn về nội dung chương này..."></textarea>
            </div>
            <div class="d-flex gap-2 justify-content-end mt-4">
                <button type="button" class="btn btn-outline-custom" onclick="closeChapterModal()">Hủy</button>
                <button type="submit" class="btn btn-primary-custom">Lưu chương</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        // Toggle chapter body
        function toggleChapter(header) {
            const body = header.nextElementSibling;
            const icon = header.querySelector('.btn-expand i');

            body.classList.toggle('show');
            icon.classList.toggle('bi-chevron-down');
            icon.classList.toggle('bi-chevron-up');
        }

        // Modal functions
        function openAddChapterModal() {
            document.getElementById('chapterModalTitle').textContent = 'Thêm chương mới';
            document.getElementById('chapterModal').classList.add('show');
        }

        function openEditChapterModal(id) {
            document.getElementById('chapterModalTitle').textContent = 'Chỉnh sửa chương';
            document.getElementById('chapterModal').classList.add('show');
        }

        function closeChapterModal() {
            document.getElementById('chapterModal').classList.remove('show');
        }

        function openAddLessonModal(chapterId) {
            alert('Mở modal thêm bài học cho chương ' + chapterId);
        }

        function openEditLessonModal(lessonId) {
            alert('Mở modal chỉnh sửa bài học ' + lessonId);
        }

        function deleteChapter(id) {
            if (confirm('Bạn có chắc muốn xóa chương này? Tất cả bài học trong chương sẽ bị xóa.')) {
                console.log('Xóa chương', id);
            }
        }

        function deleteLesson(id) {
            if (confirm('Bạn có chắc muốn xóa bài học này?')) {
                console.log('Xóa bài học', id);
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('chapterModal');
            if (event.target === modal) {
                closeChapterModal();
            }
        }
    </script>
}